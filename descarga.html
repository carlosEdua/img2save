<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
  <style>
    *{
      margin: 0;
    }
    #div{
      width: 100%;
      height: 100px;
      background: rgb(233, 233, 233);
      font-size: 21px;
    }

  </style>
</head>
<body>

  <div id="div">

  </div>
    


    <script>
      // ============== unsplash api ===============

// ============= pixabay api ==================
const pixabayKey = "12520812-7a40d4649cbc40da8e7856f3c";
const BASE_URL = "https://pixabay.com/api/?key=";

// fetch data from pixabay and transform in a specific json format
async function pixabayData(keywords,page = 1 , per_page = 10){
  try {
    
    let response = await fetch(`${BASE_URL}${pixabayKey}&q=${encodeURIComponent(keywords)}&page=${page}&per_page=${per_page}`);
    let data = await response.json();
    let arrayDataPixabay = data.hits.map( pic => {
        return {
            id: pic.id,
            description: pic.tags.replace(/,/g, ' '),
            user: pic.user,
            userProfile: `https://pixabay.com/users/${pic.user.toLowerCase()}-${pic.user_id}/`,
            fullImage: pic.largeImageURL,
            smallImage: pic.webformatURL,
            thisWeb: 'pixabay'
        }
    })
    // return the data in a standard array[jsons,...] to use later
    return arrayDataPixabay;

  }
  
  catch (error) {
    console.log(error)
    return null;
  } 
}

//====================== flickr api =========================
const apiKeyFlickr = "d8459523ee8b588801bb10887b760fa3";
//const secretFlickr = "494bc8853d697693";
// url photo format
// https://farm{farm-id}.staticflickr.com/{server-id}/{id}_{o-secret}_o.(jpg|gif|png)
// user profile url format
// https://www.flickr.com/people/{user-id}/ - profile

const BASE_URL_FLICKR = `https://www.flickr.com/services/rest/?method=flickr.photos.search`;

async function fetchFlickrData(tags, page, per_page){
    try {
        let response = await fetch(`${BASE_URL_FLICKR}&api_key=${apiKeyFlickr}&tags=${tags.replace(' ','+')}&per_page=${per_page}&page=${page}&format=json&nojsoncallback=1`);
        let data = await response.json();
        if(data.stat === "ok"){
            let arrayData = data.photos.photo.map( pic => {
                return {
                    id: pic.id,
                    description: pic.title,
                    user: 'flickr user',
                    userProfile: `https://www.flickr.com/people/${pic.owner}/`,
                    fullImage: `https://farm${pic.farm}.staticflickr.com/${pic.server}/${pic.id}_${pic.secret}_b.jpg`,
                    smallImage: `https://farm${pic.farm}.staticflickr.com/${pic.server}/${pic.id}_${pic.secret}_z.jpg`,
                    thisWeb: 'flickr'
                }
            })
            // return the data in a array[json's]
            return arrayData;
        }else{
            throw Error(`bad response ${data.stat} code: ${data.code} message ${data.message}`)
        }
    } catch (error) {
        console.log(error.message + " BAD RESPONSE");
        return null;
    }
}


const API = {
    unsplashSearch: (word, page, per_page ) => (
        fetchUnsplashData(word, page, per_page)
    ),
    pixabaySearch: (word, page, per_page ) => (
        pixabayData(word, page, per_page)
    ),
    flickrSearch: (word, page, per_page) => (
        fetchFlickrData(word, page, per_page)
    )
}
  //*****************************________________****************_______
async function fetchData(word2search){   
  let results = []; // aqui se guardarán las fotos
        let arrayPixabay, arrayFlickr;
        //let index = this.state.backgroundWordCount;
        //let word2search = this.state.words[index];
        // ***** try catch for call the two API's *****
        try {
            arrayPixabay = await API.pixabaySearch(word2search,1,10);
            arrayFlickr = await API.flickrSearch(word2search,1,10);
        } catch (err) {
            console.log(err)
            this.setState({error: err})
        }
        // comprobar que hayan llegado datos de las 2 API's
        if(arrayPixabay) results = results.concat(arrayPixabay); 
        if(arrayFlickr) results = results.concat(arrayFlickr);
      
        results = mezclar(results);
        return results;
      }

      function mezclar(arr){
        let length = arr.length;
        let auxiliar , index ;
        while(length > 0){
          index = Math.floor( Math.random() * length ); 

          length--;

          auxiliar = arr[length]; // ya se le bajó - 1 al lenght
          arr[length] = arr[index];
          arr[index] = auxiliar;
        }

        return arr;
      }
    </script>

</body>
</html>